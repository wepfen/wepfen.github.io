<!DOCTYPE html>
<html lang="en"><head>

  
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="">  


  
  <meta property="og:type" content="website">
  <meta property="og:description" content="Here are writeups for crypto challenges Easy diffy, my ZED and my BetterZED from PwnME CTF quals 2025" />
  <meta property="og:image" content="https://wepfen.github.io//images/writeups/pwnme/gmodp.png" />
  <meta property="og:url" content="https://wepfen.github.io/writeups/easy_diffy_my_zed_my_betterzed/">
  <meta property="og:title" content="PwnMe CTF quals 2025 - Easy diffy, My ZED and My BetterZED writeups [crypto]">
  <meta property="og:site_name" content="wepfen.github.io">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta property="twitter:domain" content="wepfen.github.io">
  <meta property="twitter:url" content="https://wepfen.github.io/writeups/easy_diffy_my_zed_my_betterzed/">
  <meta name="twitter:title" content="PwnMe CTF quals 2025 - Easy diffy, My ZED and My BetterZED writeups [crypto]">
  <meta name="twitter:description" content="Here are writeups for crypto challenges Easy diffy, my ZED and my BetterZED from PwnME CTF quals 2025">
  <meta name="twitter:image" content="https://wepfen.github.io//images/writeups/pwnme/gmodp.png">
  
  <title>
    
      PwnMe CTF quals 2025 - Easy diffy, My ZED and My BetterZED writeups [crypto]
    
  </title>


  <link rel="icon" type="image/gif" href="/images/oia-uia.gif" />
   

  
  
  
  
  <link rel="stylesheet" href="/css/main.9bb372a616563f9ecafd6e5ea0d7760c487f35e7358f212b258b477fbfa75f5264ef33aaffa0334383ffc444b631b8dc5c496c67b5830ab2ac1f1e226a1125c3.css" integrity="sha512-m7NyphZWP57K/W5eoNd2DEh/Nec1jyErJYtHf7&#43;nX1Jk7zOq/6AzQ4P/xES2MbjcXElsZ7WDCrKsHx4iahElww==" />

  


</head>

      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
      delimiters: [
        {left: '$$', right: '$$', display: true},     
        {left: '$', right: '$', display: false},  	  
      ],
      throwOnError : false
    });
  });
</script>



    
    <body a="dark">
        <main class="page-content" aria-label="Content">
            <div class="w">
<a href="/">~/</a>




<script src="/js/theme-toggle.f10bb0c6283b259e63664053a20ccc48c8b0980e44bceece1c10401c529c2040.js" integrity="sha256-8Quwxig7JZ5jZkBTogzMSMiwmA5EvO7OHBBAHFKcIEA="></script>

<button style="float: right; background: none; outline: none;" onclick="toggleTheme()">

<svg class="w-6 h-6 text-gray-800 dark:text-white theme" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
  <path fill-rule="evenodd" d="M7.05 4.05A7 7 0 0 1 19 9c0 2.407-1.197 3.874-2.186 5.084l-.04.048C15.77 15.362 15 16.34 15 18a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1c0-1.612-.77-2.613-1.78-3.875l-.045-.056C6.193 12.842 5 11.352 5 9a7 7 0 0 1 2.05-4.95ZM9 21a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2h-4a1 1 0 0 1-1-1Zm1.586-13.414A2 2 0 0 1 12 7a1 1 0 1 0 0-2 4 4 0 0 0-4 4 1 1 0 0 0 2 0 2 2 0 0 1 .586-1.414Z" clip-rule="evenodd"/>
</svg>

</button>






<article>
    <p class="post-meta">
        <time datetime="2025-03-04 13:19:19 &#43;0100 CET">
            2025-03-04
        </time>
    </p>

    <h1>PwnMe CTF quals 2025 - Easy diffy, My ZED and My BetterZED writeups [crypto]</h1>

    
        <aside >
            <nav id="TableOfContents">
  <ul>
    <li><a href="#easy-diffy">Easy diffy</a>
      <ul>
        <li><a href="#tldr">TL;DR</a></li>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#code-analysis">Code analysis</a>
          <ul>
            <li><a href="#diffie-hellman-reminder">Diffie Hellman reminder</a></li>
            <li><a href="#actually-reading-the-code">Actually reading the code</a></li>
          </ul>
        </li>
        <li><a href="#solving">Solving</a></li>
      </ul>
    </li>
    <li><a href="#my-zed">My ZED</a>
      <ul>
        <li><a href="#tldr-1">TL;DR</a></li>
        <li><a href="#introduction-1">Introduction</a></li>
        <li><a href="#code-analysis-1">Code analysis</a>
          <ul>
            <li><a href="#openzed">Openzed</a></li>
            <li><a href="#aes-cbc-zed">AES CBC ZED</a></li>
          </ul>
        </li>
        <li><a href="#solving-1">Solving</a>
          <ul>
            <li><a href="#intended-by-bruteforcing-the-3-remaining-bytes-of-the-password">Intended (by bruteforcing the 3 remaining bytes of the password)</a></li>
            <li><a href="#unintended-using-the-hash">Unintended (using the hash)</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#my-betterzed">My BetterZED</a>
      <ul>
        <li><a href="#tldr-2">TL;DR</a></li>
        <li><a href="#introduction-2">Introduction</a></li>
        <li><a href="#code-analysis-2">Code analysis</a>
          <ul>
            <li><a href="#web-interface-endpoints">Web interface endpoints</a></li>
            <li><a href="#wheres-the-vulnerability-">Where&rsquo;s the vulnerability ?</a></li>
          </ul>
        </li>
        <li><a href="#solving-2">Solving</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#other-writeups">Other writeups</a></li>
  </ul>
</nav>
        </aside>
    

    <p>Here are writeups for crypto challenges Easy diffy, my ZED and my BetterZED from PwnME CTF quals 2025</p>
<h1 id="easy-diffy">Easy diffy</h1>
<blockquote>
<p>Difficulty : Intro</p>
</blockquote>
<blockquote>
<p><a href="https://github.com/Phreaks-2600/PwnMeCTF-2025-quals/blob/main/Crypto/EasyDiffy/attachments/easydiffy.zip">Source files</a></p>
</blockquote>
<blockquote>
<p>Description : I managed to generate strong parameters for our diffie-hellman key exchange, i think my message is now safe.</p>
</blockquote>
<blockquote>
<p>Author : wepfen (me ofc)</p>
</blockquote>
<h2 id="tldr">TL;DR</h2>
<ul>
<li>
<p>notice that $ g \equiv p-1 \equiv -1 \mod p $</p>
</li>
<li>
<p>And when this happens, modular arithmetic tell us that $g^{k} \equiv (-1)^{k} \mod p$ which is either <code>1</code> or <code>-1</code></p>
</li>
<li>
<p>So the shared key is actually <code>g-1</code>, decrypt the flag with it</p>
</li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>For this challenge we have a python script generating diffie hellman parameters and use the shared secret sha256 hash as a AES key to encrypt the flag.</p>
<p>I made this challenge so everyone can solve a challenge and have its shot of dopamine &lt;3.</p>
<h2 id="code-analysis">Code analysis</h2>
<p>Here&rsquo;s the python script.</p>
<details>
  <summary style="color: #F99417; cursor: pointer">source.py</summary>
  <div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">from</span> Crypto.Util.number <span style="color:#e67e80">import</span> getPrime, long_to_bytes
</span></span><span style="display:flex;"><span><span style="color:#e67e80">from</span> Crypto.Util.Padding <span style="color:#e67e80">import</span> pad, unpad
</span></span><span style="display:flex;"><span><span style="color:#e67e80">from</span> Crypto.Cipher <span style="color:#e67e80">import</span> AES
</span></span><span style="display:flex;"><span><span style="color:#e67e80">from</span> hashlib <span style="color:#e67e80">import</span> sha256
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#859289;font-style:italic"># generating strong parameters</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flag <span style="color:#7a8478">=</span> <span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;REDACTED&#34;</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p <span style="color:#7a8478">=</span> getPrime(<span style="color:#d699b6">1536</span>)
</span></span><span style="display:flex;"><span>g <span style="color:#7a8478">=</span> p<span style="color:#7a8478">-</span><span style="color:#d699b6">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a <span style="color:#7a8478">=</span> getPrime(<span style="color:#d699b6">1536</span>)
</span></span><span style="display:flex;"><span>b <span style="color:#7a8478">=</span> getPrime(<span style="color:#d699b6">1536</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>A <span style="color:#7a8478">=</span> <span style="color:#d699b6">pow</span>(g, a, p)
</span></span><span style="display:flex;"><span>B <span style="color:#7a8478">=</span> <span style="color:#d699b6">pow</span>(g, b, p)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">assert</span> <span style="color:#d699b6">pow</span>(A, b, p) <span style="color:#7a8478">==</span> <span style="color:#d699b6">pow</span>(B, a, p)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>C <span style="color:#7a8478">=</span> <span style="color:#d699b6">pow</span>(B, a, p)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#859289;font-style:italic"># Encrypting my message</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>key <span style="color:#7a8478">=</span> long_to_bytes(C)
</span></span><span style="display:flex;"><span>key <span style="color:#7a8478">=</span> sha256(key)<span style="color:#7a8478">.</span>digest()[:<span style="color:#d699b6">16</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cipher <span style="color:#7a8478">=</span> AES<span style="color:#7a8478">.</span>new(key, AES<span style="color:#7a8478">.</span>MODE_ECB)
</span></span><span style="display:flex;"><span>ciphertext <span style="color:#7a8478">=</span> cipher<span style="color:#7a8478">.</span>encrypt(pad(flag, AES<span style="color:#7a8478">.</span>block_size))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#d699b6">print</span>(<span style="color:#b2c98f">f</span><span style="color:#b2c98f">&#34;</span><span style="color:#b2c98f">{</span>p <span style="color:#b2c98f">= }</span><span style="color:#b2c98f">&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#d699b6">print</span>(<span style="color:#b2c98f">f</span><span style="color:#b2c98f">&#34;</span><span style="color:#b2c98f">{</span>g <span style="color:#b2c98f">= }</span><span style="color:#b2c98f">&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#d699b6">print</span>(<span style="color:#b2c98f">&#34;ciphertext =&#34;</span>, ciphertext<span style="color:#7a8478">.</span>hex())
</span></span></code></pre></td></tr></table>
</div>
</div>
</details>

<p>And the output :</p>
<details>
  <summary style="color: #F99417; cursor: pointer">output.txt</summary>
  <div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>p <span style="color:#7a8478">=</span> <span style="color:#d699b6">1740527743356518530873219004517954317742405916450945010211514630307030225825627940655848700898186119703288416676610512180281414181211686282526701502342109420226095690170506537523420657033019751819646839624557146950127906808859045989204720555752289247833349649020285507405445896768256093961814925065500513967524214087124440421275882981975756344900858314408284866222751684730112931487043308502610244878601557822285922054548064505819094588752116864763643689272130951</span>
</span></span><span style="display:flex;"><span>g <span style="color:#7a8478">=</span> <span style="color:#d699b6">1740527743356518530873219004517954317742405916450945010211514630307030225825627940655848700898186119703288416676610512180281414181211686282526701502342109420226095690170506537523420657033019751819646839624557146950127906808859045989204720555752289247833349649020285507405445896768256093961814925065500513967524214087124440421275882981975756344900858314408284866222751684730112931487043308502610244878601557822285922054548064505819094588752116864763643689272130950</span>
</span></span><span style="display:flex;"><span>ciphertext <span style="color:#7a8478">=</span> f2803af955eebc0b24cf872f3c9e3c1fdd072c6da1202fe3c7250fd1058c0bc810b052cf99ebfe424ce82dc31a3ba94f
</span></span></code></pre></td></tr></table>
</div>
</div>
</details>

<h3 id="diffie-hellman-reminder">Diffie Hellman reminder</h3>
<p>Before reading the code, here&rsquo;s a quick recap of diffie hellman key exchange.</p>
<p>We got two person Alice and Bob who want to talk securely by encrypting their message with the same key. But they can&rsquo;t scream this key in front of everyone, because some eavesdroppers can steal this key to decrypt their conversation.</p>
<p>So instead, they exchange the key using mathematics.</p>
<p>Two public variables are selected and shared by Alice and Bob : <code>g</code> and <code>p</code>. <code>p</code> is a prime number and <code>g</code> is used to generate public keys.</p>
<p>Then Alice select a random number <code>a</code> modulo p, and compute it&rsquo;s public key <code>A</code> using <code>g</code> : </p>
$$A \equiv g^{a} \mod p$$<p>Then Bob does the same with it&rsquo;s private key <code>b</code> and send its public key <code>B</code> to Alice and receive Alice&rsquo;s public key.</p>
<p>Then they compute the shared secret <code>s</code> that will be the symmectric key to encrypt their communication :</p>
$$ s \equiv A^{b} \equiv (g^{a})^{b} \equiv g^{ab}\mod p $$<p>
</p>
$$ s \equiv B^{a} \equiv (g^{b})^{a} \equiv g^{ba}\mod p $$<p><img src="https://upload.wikimedia.org/wikipedia/commons/c/c8/DiffieHellman.png" alt="DHKE wikipedia"></p>
<h3 id="actually-reading-the-code">Actually reading the code</h3>
<ol>
<li>First a prime <code>p</code> is randomly generated and the generator <code>g</code> is equal to $p-1$</li>
</ol>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>p <span style="color:#7a8478">=</span> getPrime(<span style="color:#d699b6">1536</span>)
</span></span><span style="display:flex;"><span>g <span style="color:#7a8478">=</span> p<span style="color:#7a8478">-</span><span style="color:#d699b6">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>A generator is, as his name suggest, used to generate a group of number by computing $g^{k} \mod p$. So if wrongly chosen, the group of number can be small and so it can compromise the robustness of the key exchange.</p>
</blockquote>
<ol start="2">
<li>The private keys <code>a</code> and <code>b</code> are randomly chosen</li>
</ol>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>a <span style="color:#7a8478">=</span> getPrime(<span style="color:#d699b6">1536</span>)
</span></span><span style="display:flex;"><span>b <span style="color:#7a8478">=</span> getPrime(<span style="color:#d699b6">1536</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>The public keys <code>A</code> and <code>B</code> are computed using the generator and the private keys</li>
</ol>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>A <span style="color:#7a8478">=</span> <span style="color:#d699b6">pow</span>(g, a, p)
</span></span><span style="display:flex;"><span>B <span style="color:#7a8478">=</span> <span style="color:#d699b6">pow</span>(g, b, p)
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>The shared secret is computed</li>
</ol>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">assert</span> <span style="color:#d699b6">pow</span>(A, b, p) <span style="color:#7a8478">==</span> <span style="color:#d699b6">pow</span>(B, a, p)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>C <span style="color:#7a8478">=</span> <span style="color:#d699b6">pow</span>(B, a, p)
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>Finally the shared secret is used as a key and the flag is encrypted with it</li>
</ol>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>key <span style="color:#7a8478">=</span> long_to_bytes(C)
</span></span><span style="display:flex;"><span>key <span style="color:#7a8478">=</span> sha256(key)<span style="color:#7a8478">.</span>digest()[:<span style="color:#d699b6">16</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cipher <span style="color:#7a8478">=</span> AES<span style="color:#7a8478">.</span>new(key, AES<span style="color:#7a8478">.</span>MODE_ECB)
</span></span><span style="display:flex;"><span>ciphertext <span style="color:#7a8478">=</span> cipher<span style="color:#7a8478">.</span>encrypt(pad(flag, AES<span style="color:#7a8478">.</span>block_size))
</span></span></code></pre></td></tr></table>
</div>
</div><p>One may think it is a classic diffie hellman key exchange but by quickly looking at the <a href="https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange">DHKE wiki page</a>, we can understand that the chosen generator is uncommon.</p>
<p>Knowing a little bit of modular arithmetic (or just testing out the code), we can figure out that using $g = p-1$ makes every power of g equal to 1 or -1 mod p.</p>
<p>So, the public keys A and B, which are a power of <code>g</code>,are either 1 or -1 :</p>
$$ g \equiv p-1 \mod p $$<p>
</p>
$$ g \equiv -1 \mod p $$<p>
</p>
$$ (-1)^{k} \equiv \pm 1 \mod p$$<p>It is equal to 1 if <code>k</code> is even.
And it is equal to 1 if <code>k</code> is odd.</p>
$$
(-1)^k=\begin{cases} 
      -1 & k=\text{odd} \\
      1 & k=\text{even }
   \end{cases}
$$<p>But as the private keys are prime numbers, they are odd :</p>
$$ g^{a} \equiv g^{b} \equiv -1 \equiv p-1 \mod p $$<p>So the shared secert is actually $p-1$.</p>
<p><img src="../../images/writeups/pwnme/gmodp.png" alt="gmodp barney"></p>
<p>And a topic about this : <a href="https://crypto.stackexchange.com/questions/77868/for-diffie-hellman-why-is-a-g-value-of-p%e2%88%921-not-a-suitable-choice">https://crypto.stackexchange.com/questions/77868/for-diffie-hellman-why-is-a-g-value-of-p%e2%88%921-not-a-suitable-choice</a>.</p>
<h2 id="solving">Solving</h2>
<p>As we stated that the private key is p-1, we can reuse the g from the output.txt as the private key.</p>
<details>
  <summary style="color: #F99417; cursor: pointer">solve.py</summary>
  <div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">from</span> Crypto.Cipher <span style="color:#e67e80">import</span> AES
</span></span><span style="display:flex;"><span><span style="color:#e67e80">from</span> Crypto.Util.Padding <span style="color:#e67e80">import</span> unpad
</span></span><span style="display:flex;"><span><span style="color:#e67e80">from</span> Crypto.Util.number <span style="color:#e67e80">import</span> long_to_bytes
</span></span><span style="display:flex;"><span><span style="color:#e67e80">from</span> hashlib <span style="color:#e67e80">import</span> sha256
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p <span style="color:#7a8478">=</span> <span style="color:#d699b6">1740527743356518530873219004517954317742405916450945010211514630307030225825627940655848700898186119703288416676610512180281414181211686282526701502342109420226095690170506537523420657033019751819646839624557146950127906808859045989204720555752289247833349649020285507405445896768256093961814925065500513967524214087124440421275882981975756344900858314408284866222751684730112931487043308502610244878601557822285922054548064505819094588752116864763643689272130951</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ciphertext <span style="color:#7a8478">=</span>  <span style="color:#d699b6">bytes</span><span style="color:#7a8478">.</span>fromhex(<span style="color:#b2c98f">&#34;f2803af955eebc0b24cf872f3c9e3c1fdd072c6da1202fe3c7250fd1058c0bc810b052cf99ebfe424ce82dc31a3ba94f&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>shared_secret <span style="color:#7a8478">=</span> p <span style="color:#7a8478">-</span> <span style="color:#d699b6">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>key <span style="color:#7a8478">=</span> long_to_bytes(shared_secret)
</span></span><span style="display:flex;"><span>key <span style="color:#7a8478">=</span> sha256(key)<span style="color:#7a8478">.</span>digest()[:<span style="color:#d699b6">16</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cipher <span style="color:#7a8478">=</span> AES<span style="color:#7a8478">.</span>new(key, AES<span style="color:#7a8478">.</span>MODE_ECB)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>message <span style="color:#7a8478">=</span> unpad(cipher<span style="color:#7a8478">.</span>decrypt(ciphertext), <span style="color:#d699b6">16</span>)
</span></span><span style="display:flex;"><span><span style="color:#d699b6">print</span>(message)
</span></span></code></pre></td></tr></table>
</div>
</div>
</details>

<p>FLAG : <code>PWNME{411_my_h0m13s_h4t35_sm411_Gs}</code></p>
<h1 id="my-zed">My ZED</h1>
<blockquote>
<p>Difficulty : Easy</p>
</blockquote>
<blockquote>
<p><a href="https://github.com/Phreaks-2600/PwnMeCTF-2025-quals/raw/refs/heads/main/Crypto/MyZed/attachments/my_zed.zip">Source files</a></p>
</blockquote>
<blockquote>
<p>Description : Tried to make an opensource zedencrypt in 2 weeks but i got doubts about it &hellip;</p>
</blockquote>
<blockquote>
<p>Author : wepfen (me again)</p>
</blockquote>
<h2 id="tldr-1">TL;DR</h2>
<ul>
<li>
<p>Decompress ciphertext with zlib</p>
</li>
<li>
<p>Get IV which is prepended to the cipertext</p>
</li>
<li>
<p>Intended way :</p>
<ol>
<li>
<p>The IV is made of the concatenation of the username and the password, so it has a part of the password used to generate the key</p>
</li>
<li>
<p>So we can get the 13 first characters of the password and we need to bruteforce the three lasts</p>
</li>
<li>
<p>Decrypt the ciphertext</p>
</li>
</ol>
</li>
<li>
<p>Unintended way :</p>
<ol>
<li>
<p>Decode the hash in the metadata from hex</p>
</li>
<li>
<p>Get the first 16 bytes and decrypt the ciphertext with it</p>
</li>
</ol>
</li>
</ul>
<h2 id="introduction-1">Introduction</h2>
<p>For this challenge, we have got a custom lib that can encrypt files given an username, a password and a filename.</p>
<p>It then generate a ciphertext, prepend it by a magic bytes and the metadata in JSON format and write it to a file with &ldquo;OZED&rdquo; extension.</p>
<p>The plaintext is compressed with zlib before getting encrypted with AES-CBC-ZED, a mix of AES-CBC and AES-CFB.</p>
<blockquote>
<p><a href="https://www.sstic.org/media/SSTIC2024/SSTIC-actes/zed-files__aux_frontires_du_rel/SSTIC2024-Article-zed-files__aux_frontires_du_rel-mougey_GIwCgVf.pdf"> A paper from Camille Mougey at sstic 2024</a> gave me the idea of this challenge. We can find AES CBC ZED at section 2.5</p>
</blockquote>
<h2 id="code-analysis-1">Code analysis</h2>
<p>Here&rsquo;s the challenge script :</p>
<details>
  <summary style="color: #F99417; cursor: pointer">challenge.py</summary>
  <div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">from</span> openzedlib <span style="color:#e67e80">import</span> openzed
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> zlib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">from</span> flag <span style="color:#e67e80">import</span> FLAG
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>file <span style="color:#7a8478">=</span> openzed<span style="color:#7a8478">.</span>Openzed(<span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#39;zed&#39;</span>, os<span style="color:#7a8478">.</span>urandom(<span style="color:#d699b6">16</span>), <span style="color:#b2c98f">&#39;flag.txt&#39;</span>, <span style="color:#d699b6">len</span>(FLAG))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>file<span style="color:#7a8478">.</span>encrypt(FLAG)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>file<span style="color:#7a8478">.</span>generate_container()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">with</span> <span style="color:#d699b6">open</span>(<span style="color:#b2c98f">f</span><span style="color:#b2c98f">&#34;</span><span style="color:#b2c98f">{</span>file<span style="color:#7a8478">.</span>filename<span style="color:#b2c98f">}</span><span style="color:#b2c98f">.ozed&#34;</span>, <span style="color:#b2c98f">&#34;wb&#34;</span>) <span style="color:#e67e80">as</span> f:
</span></span><span style="display:flex;"><span>	f<span style="color:#7a8478">.</span>write(file<span style="color:#7a8478">.</span>secure_container)
</span></span></code></pre></td></tr></table>
</div>
</div>
</details>

<p>Which relies on openzed.py :</p>
<details>
  <summary style="color: #F99417; cursor: pointer">openzed.py</summary>
  <div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">77
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">from</span> openzedlib.aes_cbc_zed <span style="color:#e67e80">import</span> AES_CBC_ZED 
</span></span><span style="display:flex;"><span><span style="color:#e67e80">from</span> hashlib <span style="color:#e67e80">import</span> sha256
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> zlib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">class</span> Openzed:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">__init__</span>(<span style="color:#d699b6">self</span>, user<span style="color:#7a8478">=</span><span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;user&#34;</span>, password<span style="color:#7a8478">=</span><span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;OpenZEDdefaultpasswordtochangebeforedeployinproduction&#34;</span>, filename<span style="color:#7a8478">=</span><span style="color:#b2c98f">&#34;file&#34;</span>, size<span style="color:#7a8478">=</span><span style="color:#d699b6">0</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>user <span style="color:#7a8478">=</span> user
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password <span style="color:#7a8478">=</span> password
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>filename <span style="color:#7a8478">=</span> filename
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>size <span style="color:#7a8478">=</span> size
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>generate_metadata()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#b2c98f">&#34;&#34;&#34;Metadata 
</span></span></span><span style="display:flex;"><span><span style="color:#b2c98f">	format : {&#34;size&#34;: 0, &#34;filename&#34;: &#34;&#34;, &#34;user&#34;: &#34;&#34;, &#34;password_hash&#34;: &#34;&#34;}+padding
</span></span></span><span style="display:flex;"><span><span style="color:#b2c98f">
</span></span></span><span style="display:flex;"><span><span style="color:#b2c98f">	(size = 300 bytes and formatted in json)
</span></span></span><span style="display:flex;"><span><span style="color:#b2c98f">	
</span></span></span><span style="display:flex;"><span><span style="color:#b2c98f">	header (&#34;OZED&#34;) -&gt; 4
</span></span></span><span style="display:flex;"><span><span style="color:#b2c98f">	size -&gt; 4
</span></span></span><span style="display:flex;"><span><span style="color:#b2c98f">	filename -&gt; 112
</span></span></span><span style="display:flex;"><span><span style="color:#b2c98f">	user -&gt; 32
</span></span></span><span style="display:flex;"><span><span style="color:#b2c98f">	password_hash -&gt; 64
</span></span></span><span style="display:flex;"><span><span style="color:#b2c98f">	json size -&gt; 60
</span></span></span><span style="display:flex;"><span><span style="color:#b2c98f">	&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">generate_metadata</span>(<span style="color:#d699b6">self</span>):
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		metadata <span style="color:#7a8478">=</span> {}
</span></span><span style="display:flex;"><span>		metadata[<span style="color:#b2c98f">&#34;user&#34;</span>] <span style="color:#7a8478">=</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>user<span style="color:#7a8478">.</span>decode()
</span></span><span style="display:flex;"><span>		metadata[<span style="color:#b2c98f">&#34;password_hash&#34;</span>] <span style="color:#7a8478">=</span> sha256(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password)<span style="color:#7a8478">.</span>hexdigest()
</span></span><span style="display:flex;"><span>		metadata[<span style="color:#b2c98f">&#34;filename&#34;</span>] <span style="color:#7a8478">=</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>filename
</span></span><span style="display:flex;"><span>		metadata[<span style="color:#b2c98f">&#34;size&#34;</span>] <span style="color:#7a8478">=</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>metadata <span style="color:#7a8478">=</span> json<span style="color:#7a8478">.</span>dumps(metadata)<span style="color:#7a8478">.</span>encode()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>padding_len <span style="color:#7a8478">=</span> <span style="color:#d699b6">300</span><span style="color:#7a8478">-</span><span style="color:#d699b6">len</span>(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>metadata)
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>metadata <span style="color:#7a8478">+=</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>padding_len<span style="color:#7a8478">*</span><span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;</span><span style="color:#b2c98f">\x00</span><span style="color:#b2c98f">&#34;</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>metadata
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">encrypt</span>(<span style="color:#d699b6">self</span>, data):
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		cipher <span style="color:#7a8478">=</span> AES_CBC_ZED(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>user, <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password)
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>encrypted <span style="color:#7a8478">=</span> cipher<span style="color:#7a8478">.</span>encrypt(data)
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>encrypted <span style="color:#7a8478">=</span> zlib<span style="color:#7a8478">.</span>compress(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>encrypted) <span style="color:#859289;font-style:italic"># just for the lore</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>encrypted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">decrypt</span>(<span style="color:#d699b6">self</span>, ciphertext):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		cipher <span style="color:#7a8478">=</span> AES_CBC_ZED(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>user, <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password)
</span></span><span style="display:flex;"><span>		ciphertext <span style="color:#7a8478">=</span> zlib<span style="color:#7a8478">.</span>decompress(ciphertext)
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>decrypted <span style="color:#7a8478">=</span> cipher<span style="color:#7a8478">.</span>decrypt(ciphertext)
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>decrypted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">generate_container</span>(<span style="color:#d699b6">self</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>secure_container <span style="color:#7a8478">=</span> <span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#39;OZED&#39;</span> <span style="color:#7a8478">+</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>metadata <span style="color:#7a8478">+</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>encrypted
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>secure_container
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">decrypt_container</span>(<span style="color:#d699b6">self</span>, container):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>read_metadata()
</span></span><span style="display:flex;"><span>		filename <span style="color:#7a8478">=</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>parsed_metadata[<span style="color:#b2c98f">&#34;filename&#34;</span>]
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		ciphertext <span style="color:#7a8478">=</span> container[<span style="color:#d699b6">304</span>:]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		plaintext <span style="color:#7a8478">=</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>decrypt(ciphertext)
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> {<span style="color:#b2c98f">&#34;data&#34;</span>:plaintext, <span style="color:#b2c98f">&#34;filename&#34;</span>:filename}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">read_metadata</span>(<span style="color:#d699b6">self</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>parsed_metadata <span style="color:#7a8478">=</span> json<span style="color:#7a8478">.</span>loads(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>secure_container[<span style="color:#d699b6">4</span>:<span style="color:#d699b6">300</span><span style="color:#7a8478">-</span><span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>padding_len<span style="color:#7a8478">+</span><span style="color:#d699b6">4</span>])
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>parsed_metadata
</span></span></code></pre></td></tr></table>
</div>
</div>
</details>

<p>Which relies on aes_cbc_zed.py :</p>
<details>
  <summary style="color: #F99417; cursor: pointer">aes_cbc_zed.py</summary>
  <div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">89
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">from</span> Crypto.Cipher <span style="color:#e67e80">import</span> AES
</span></span><span style="display:flex;"><span><span style="color:#e67e80">from</span> hashlib <span style="color:#e67e80">import</span> sha256
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">def</span> <span style="color:#b2c98f">xor</span>(a: <span style="color:#d699b6">bytes</span>, b: <span style="color:#d699b6">bytes</span>) <span style="color:#7a8478">-&gt;</span> <span style="color:#d699b6">bytes</span>:
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">return</span> <span style="color:#d699b6">bytes</span>(x<span style="color:#7a8478">^</span>y <span style="color:#e67e80">for</span> x,y <span style="color:#7a8478">in</span> <span style="color:#d699b6">zip</span>(a,b))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">class</span> AES_CBC_ZED:
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">__init__</span>(<span style="color:#d699b6">self</span>, user, password):
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>user <span style="color:#7a8478">=</span> user
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password <span style="color:#7a8478">=</span> password
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>derive_password()
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>generate_iv()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">encrypt</span>(<span style="color:#d699b6">self</span>, plaintext: <span style="color:#d699b6">bytes</span>):
</span></span><span style="display:flex;"><span>		iv <span style="color:#7a8478">=</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>iv
</span></span><span style="display:flex;"><span>		ciphertext <span style="color:#7a8478">=</span> <span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>		ecb_cipher <span style="color:#7a8478">=</span> AES<span style="color:#7a8478">.</span>new(key<span style="color:#7a8478">=</span><span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>key, mode<span style="color:#7a8478">=</span>AES<span style="color:#7a8478">.</span>MODE_ECB)
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">for</span> pos <span style="color:#7a8478">in</span> <span style="color:#d699b6">range</span>(<span style="color:#d699b6">0</span>, <span style="color:#d699b6">len</span>(plaintext), <span style="color:#d699b6">16</span>):
</span></span><span style="display:flex;"><span>			chunk <span style="color:#7a8478">=</span> plaintext[pos:pos<span style="color:#7a8478">+</span><span style="color:#d699b6">16</span>]
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>			<span style="color:#859289;font-style:italic"># AES CFB for the last block or if there is only one block</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e67e80">if</span> <span style="color:#d699b6">len</span>(plaintext[pos<span style="color:#7a8478">+</span><span style="color:#d699b6">16</span>:pos<span style="color:#7a8478">+</span><span style="color:#d699b6">32</span>]) <span style="color:#7a8478">==</span> <span style="color:#d699b6">0</span> :
</span></span><span style="display:flex;"><span>				<span style="color:#859289;font-style:italic">#if plaintext length &lt;= 16, iv = self.iv</span>
</span></span><span style="display:flex;"><span>				<span style="color:#e67e80">if</span> <span style="color:#d699b6">len</span>(plaintext) <span style="color:#7a8478">&lt;=</span> <span style="color:#d699b6">16</span> :
</span></span><span style="display:flex;"><span>					prev<span style="color:#7a8478">=</span>iv
</span></span><span style="display:flex;"><span>				<span style="color:#859289;font-style:italic"># else, iv = previous ciphertext</span>
</span></span><span style="display:flex;"><span>				<span style="color:#e67e80">else</span>:
</span></span><span style="display:flex;"><span>					prev<span style="color:#7a8478">=</span>ciphertext[pos<span style="color:#7a8478">-</span><span style="color:#d699b6">16</span>:pos]
</span></span><span style="display:flex;"><span>					
</span></span><span style="display:flex;"><span>				prev <span style="color:#7a8478">=</span> ecb_cipher<span style="color:#7a8478">.</span>encrypt(prev)
</span></span><span style="display:flex;"><span>				ciphertext <span style="color:#7a8478">+=</span> xor(chunk, prev)
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>			<span style="color:#859289;font-style:italic"># AES CBC for the n-1 firsts block</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e67e80">elif</span> <span style="color:#7a8478">not</span> ciphertext:
</span></span><span style="display:flex;"><span>				xored <span style="color:#7a8478">=</span> <span style="color:#d699b6">bytes</span>(xor(plaintext, iv))
</span></span><span style="display:flex;"><span>				ciphertext <span style="color:#7a8478">+=</span> ecb_cipher<span style="color:#7a8478">.</span>encrypt(xored)
</span></span><span style="display:flex;"><span>				
</span></span><span style="display:flex;"><span>			<span style="color:#e67e80">else</span>:
</span></span><span style="display:flex;"><span>				xored <span style="color:#7a8478">=</span> <span style="color:#d699b6">bytes</span>(xor(chunk, ciphertext[pos<span style="color:#7a8478">-</span><span style="color:#d699b6">16</span>:pos]))
</span></span><span style="display:flex;"><span>				ciphertext <span style="color:#7a8478">+=</span> ecb_cipher<span style="color:#7a8478">.</span>encrypt(xored)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> iv <span style="color:#7a8478">+</span> ciphertext
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">decrypt</span>(<span style="color:#d699b6">self</span>, ciphertext: <span style="color:#d699b6">bytes</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#859289;font-style:italic"># TODO prendre un iv déjà connu en paramètre ?</span>
</span></span><span style="display:flex;"><span>		plaintext <span style="color:#7a8478">=</span> <span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>		ecb_cipher <span style="color:#7a8478">=</span> AES<span style="color:#7a8478">.</span>new(key<span style="color:#7a8478">=</span><span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>key, mode<span style="color:#7a8478">=</span>AES<span style="color:#7a8478">.</span>MODE_ECB)
</span></span><span style="display:flex;"><span>		iv <span style="color:#7a8478">=</span> ciphertext[:<span style="color:#d699b6">16</span>]
</span></span><span style="display:flex;"><span>		ciphertext <span style="color:#7a8478">=</span> ciphertext[<span style="color:#d699b6">16</span>:]
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">for</span> pos <span style="color:#7a8478">in</span> <span style="color:#d699b6">range</span>(<span style="color:#d699b6">0</span>, <span style="color:#d699b6">len</span>(ciphertext), <span style="color:#d699b6">16</span>):
</span></span><span style="display:flex;"><span>			chunk <span style="color:#7a8478">=</span> ciphertext[pos:pos<span style="color:#7a8478">+</span><span style="color:#d699b6">16</span>]
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>			<span style="color:#859289;font-style:italic"># AES CFB for the last block or if there is only one block</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e67e80">if</span> <span style="color:#d699b6">len</span>(ciphertext[pos<span style="color:#7a8478">+</span><span style="color:#d699b6">16</span>:pos<span style="color:#7a8478">+</span><span style="color:#d699b6">32</span>]) <span style="color:#7a8478">==</span> <span style="color:#d699b6">0</span> :
</span></span><span style="display:flex;"><span>				
</span></span><span style="display:flex;"><span>				<span style="color:#859289;font-style:italic">#if plaintext length &lt;= 16, iv = self.iv</span>
</span></span><span style="display:flex;"><span>				<span style="color:#e67e80">if</span> <span style="color:#d699b6">len</span>(ciphertext) <span style="color:#7a8478">&lt;=</span> <span style="color:#d699b6">16</span> :
</span></span><span style="display:flex;"><span>					prev<span style="color:#7a8478">=</span>iv
</span></span><span style="display:flex;"><span>				<span style="color:#859289;font-style:italic"># else, iv = previous ciphertext</span>
</span></span><span style="display:flex;"><span>				<span style="color:#e67e80">else</span>:
</span></span><span style="display:flex;"><span>					prev<span style="color:#7a8478">=</span>ciphertext[pos<span style="color:#7a8478">-</span><span style="color:#d699b6">16</span>:pos]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>				prev <span style="color:#7a8478">=</span> ecb_cipher<span style="color:#7a8478">.</span>encrypt(prev)
</span></span><span style="display:flex;"><span>				plaintext <span style="color:#7a8478">+=</span> xor(prev, chunk)
</span></span><span style="display:flex;"><span>				
</span></span><span style="display:flex;"><span>			<span style="color:#859289;font-style:italic"># AES CBC for the n-1 firsts block</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e67e80">elif</span> <span style="color:#7a8478">not</span> plaintext:
</span></span><span style="display:flex;"><span>				xored <span style="color:#7a8478">=</span> ecb_cipher<span style="color:#7a8478">.</span>decrypt(chunk)
</span></span><span style="display:flex;"><span>				plaintext <span style="color:#7a8478">+=</span> <span style="color:#d699b6">bytes</span>(xor(xored, iv))
</span></span><span style="display:flex;"><span>				
</span></span><span style="display:flex;"><span>			<span style="color:#e67e80">else</span>:
</span></span><span style="display:flex;"><span>				xored <span style="color:#7a8478">=</span> ecb_cipher<span style="color:#7a8478">.</span>decrypt(chunk)
</span></span><span style="display:flex;"><span>				plaintext <span style="color:#7a8478">+=</span> <span style="color:#d699b6">bytes</span>(xor(xored, ciphertext[pos<span style="color:#7a8478">-</span><span style="color:#d699b6">16</span>:pos]))
</span></span><span style="display:flex;"><span>				
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> plaintext
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">derive_password</span>(<span style="color:#d699b6">self</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">for</span> i <span style="color:#7a8478">in</span> <span style="color:#d699b6">range</span>(<span style="color:#d699b6">100</span>):
</span></span><span style="display:flex;"><span>			<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>key <span style="color:#7a8478">=</span> sha256(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password)<span style="color:#7a8478">.</span>digest()[:<span style="color:#d699b6">16</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">generate_iv</span>(<span style="color:#d699b6">self</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>iv <span style="color:#7a8478">=</span> (<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>user<span style="color:#7a8478">+</span><span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password)[:<span style="color:#d699b6">16</span>]
</span></span></code></pre></td></tr></table>
</div>
</div>
</details>

<p>So, in <code>challenge.py</code>, a Openzed intance is created with the username <code>zed</code>, a random password and the filename &ldquo;flag.txt&rdquo;.</p>
<p><code>file = openzed.Openzed(b'zed', os.urandom(16), 'flag.txt', len(FLAG))</code></p>
<p>It&rsquo;s encrypted with the method <code>encrypt()</code> and a generate the secure container.</p>
<p>Let&rsquo;s dig in the openzed object to see what happens here.</p>
<h3 id="openzed">Openzed</h3>
<p>First, the initialization of the class :</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">class</span> Openzed:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">__init__</span>(<span style="color:#d699b6">self</span>, user<span style="color:#7a8478">=</span><span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;user&#34;</span>, password<span style="color:#7a8478">=</span><span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;OpenZEDdefaultpasswordtochangebeforedeployinproduction&#34;</span>, filename<span style="color:#7a8478">=</span><span style="color:#b2c98f">&#34;file&#34;</span>, size<span style="color:#7a8478">=</span><span style="color:#d699b6">0</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>user <span style="color:#7a8478">=</span> user
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password <span style="color:#7a8478">=</span> password
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>filename <span style="color:#7a8478">=</span> filename
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>size <span style="color:#7a8478">=</span> size
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>generate_metadata()
</span></span></code></pre></td></tr></table>
</div>
</div><p>The default variable values are unused because they are overwriten in challenge.py.</p>
<p>A function is called, <code>generate_metadata()</code> :</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">def</span> <span style="color:#b2c98f">generate_metadata</span>(<span style="color:#d699b6">self</span>):
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		metadata <span style="color:#7a8478">=</span> {}
</span></span><span style="display:flex;"><span>		metadata[<span style="color:#b2c98f">&#34;user&#34;</span>] <span style="color:#7a8478">=</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>user<span style="color:#7a8478">.</span>decode()
</span></span><span style="display:flex;"><span>		metadata[<span style="color:#b2c98f">&#34;password_hash&#34;</span>] <span style="color:#7a8478">=</span> sha256(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password)<span style="color:#7a8478">.</span>hexdigest()
</span></span><span style="display:flex;"><span>		metadata[<span style="color:#b2c98f">&#34;filename&#34;</span>] <span style="color:#7a8478">=</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>filename
</span></span><span style="display:flex;"><span>		metadata[<span style="color:#b2c98f">&#34;size&#34;</span>] <span style="color:#7a8478">=</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>size
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>metadata <span style="color:#7a8478">=</span> json<span style="color:#7a8478">.</span>dumps(metadata)<span style="color:#7a8478">.</span>encode()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>padding_len <span style="color:#7a8478">=</span> <span style="color:#d699b6">300</span><span style="color:#7a8478">-</span><span style="color:#d699b6">len</span>(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>metadata)
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>metadata <span style="color:#7a8478">+=</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>padding_len<span style="color:#7a8478">*</span><span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;</span><span style="color:#b2c98f">\x00</span><span style="color:#b2c98f">&#34;</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>metadata
</span></span></code></pre></td></tr></table>
</div>
</div><p>Which put the username, the password hash in sha256, the filename and the size in a JSON and store it in <code>metadata</code> attribute.
It adds padding at the end of it by substracting the length of the metadata with 300. <strong>So the metadata length is maximum 300 characters</strong>.</p>
<p>Now looking at the <code>encrypt()</code> function in openzed:</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">def</span> <span style="color:#b2c98f">encrypt</span>(<span style="color:#d699b6">self</span>, data):
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		cipher <span style="color:#7a8478">=</span> AES_CBC_ZED(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>user, <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password)
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>encrypted <span style="color:#7a8478">=</span> cipher<span style="color:#7a8478">.</span>encrypt(data)
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>encrypted <span style="color:#7a8478">=</span> zlib<span style="color:#7a8478">.</span>compress(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>encrypted) <span style="color:#859289;font-style:italic"># just for the lore</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>encrypted
</span></span></code></pre></td></tr></table>
</div>
</div><p>It calls aes_cbc_zed python file, encrypt the data with the latter and compress the result with zlib (for the lore of the &lsquo;secure&rsquo; <strong>compressed</strong> container).</p>
<p>Let&rsquo;s dive in <code>aes_cbc_zed.py</code>.</p>
<h3 id="aes-cbc-zed">AES CBC ZED</h3>
<p>At initialization:</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">class</span> AES_CBC_ZED:
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">__init__</span>(<span style="color:#d699b6">self</span>, user, password):
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>user <span style="color:#7a8478">=</span> user
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password <span style="color:#7a8478">=</span> password
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>derive_password()
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>generate_iv()
</span></span></code></pre></td></tr></table>
</div>
</div><p>It sets the specified username and password, generate a key using <code>derive_password</code> and generate an iv.</p>
<p>Let&rsquo;s <code>derive_password()</code></p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">def</span> <span style="color:#b2c98f">derive_password</span>(<span style="color:#d699b6">self</span>):
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">for</span> i <span style="color:#7a8478">in</span> <span style="color:#d699b6">range</span>(<span style="color:#d699b6">100</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>key <span style="color:#7a8478">=</span> sha256(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password)<span style="color:#7a8478">.</span>digest()[:<span style="color:#d699b6">16</span>]
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Well, I badly messed up my code resulting in using the password hash as the key and having at the same time, the password hash in the metadata. Thanks to <a href="https://www.root-me.org/dolipr4necrypt0">dolipr4necrypt0</a> who noticed that.</p>
</blockquote>
<p>It was supposed to hashes the password 100 times in a row taking the 16 first bytes each times , and store the result in <code>self.key</code>.
But i messed up, and actually it just hash the password one time.</p>
<p>It should have been that :</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">def</span> <span style="color:#b2c98f">derive_password</span>(<span style="color:#d699b6">self</span>):
</span></span><span style="display:flex;"><span>  <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>key <span style="color:#7a8478">=</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">for</span> i <span style="color:#7a8478">in</span> <span style="color:#d699b6">range</span>(<span style="color:#d699b6">100</span>):
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>key <span style="color:#7a8478">=</span> sha512(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>key)<span style="color:#7a8478">.</span>digest()[:<span style="color:#d699b6">16</span>]
</span></span></code></pre></td></tr></table>
</div>
</div><p>I use sha512 so that the player cannot recover the the key with the sha256 hash of the password in the metadata.</p>
<p>And what about <code>generate_iv()</code> :</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">def</span> <span style="color:#b2c98f">generate_iv</span>(<span style="color:#d699b6">self</span>):
</span></span><span style="display:flex;"><span>	<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>iv <span style="color:#7a8478">=</span> (<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>user<span style="color:#7a8478">+</span><span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password)[:<span style="color:#d699b6">16</span>]
</span></span></code></pre></td></tr></table>
</div>
</div><p>Well, it leaks a pretty useful part of the password, we miss the last three characters, which allow us to bruteforce 256**3 == 16777216 possiblities (doable).
And usually, the IV is supposed safe to share and is necessary to decrypt files, so it is given.</p>
<p>Reading <code>encrypt()</code>, we see that that the return value is <code>iv + ciphertext</code>.</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">encrypt</span>(<span style="color:#d699b6">self</span>, plaintext: <span style="color:#d699b6">bytes</span>):
</span></span><span style="display:flex;"><span>		iv <span style="color:#7a8478">=</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>iv
</span></span><span style="display:flex;"><span>		ciphertext <span style="color:#7a8478">=</span> <span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>		ecb_cipher <span style="color:#7a8478">=</span> AES<span style="color:#7a8478">.</span>new(key<span style="color:#7a8478">=</span><span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>key, mode<span style="color:#7a8478">=</span>AES<span style="color:#7a8478">.</span>MODE_ECB)
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>    [ <span style="color:#7a8478">...</span> ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> iv <span style="color:#7a8478">+</span> ciphertext
</span></span></code></pre></td></tr></table>
</div>
</div><p>And <code>decrypt()</code> function extract IV from the cipertext:</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">def</span> <span style="color:#b2c98f">decrypt</span>(<span style="color:#d699b6">self</span>, ciphertext: <span style="color:#d699b6">bytes</span>):
</span></span><span style="display:flex;"><span>	plaintext <span style="color:#7a8478">=</span> <span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>	ecb_cipher <span style="color:#7a8478">=</span> AES<span style="color:#7a8478">.</span>new(key<span style="color:#7a8478">=</span><span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>key, mode<span style="color:#7a8478">=</span>AES<span style="color:#7a8478">.</span>MODE_ECB)
</span></span><span style="display:flex;"><span>	iv <span style="color:#7a8478">=</span> ciphertext[:<span style="color:#d699b6">16</span>]
</span></span><span style="display:flex;"><span>	ciphertext <span style="color:#7a8478">=</span> ciphertext[<span style="color:#d699b6">16</span>:]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  [ <span style="color:#7a8478">...</span> ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#e67e80">return</span> plaintext
</span></span></code></pre></td></tr></table>
</div>
</div><p>So, we can recover the part of the password from there and bruteforce the 3 last bytes.</p>
<h2 id="solving-1">Solving</h2>
<p>So knowing that, we can extract the ciphertext from the output file <code>flag.txt.ozed</code>.</p>
<p>Remember that the file is made of the &lsquo;OZED&rsquo; magic byte followed by 300 bytes of metadata and then, the ciphertext which is composed of the IV followed by the ciphertext.</p>
<p>Then to get the IV we can read from the ozed file and get 16 bytes after 304 bytes:</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>container_file <span style="color:#7a8478">=</span> <span style="color:#d699b6">open</span>(<span style="color:#b2c98f">&#34;flag.txt.ozed&#34;</span>, <span style="color:#b2c98f">&#34;rb&#34;</span>)<span style="color:#7a8478">.</span>read()
</span></span><span style="display:flex;"><span>ciphertext <span style="color:#7a8478">=</span> zlib<span style="color:#7a8478">.</span>decompress(container_file[<span style="color:#d699b6">304</span>:])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>iv <span style="color:#7a8478">=</span> ciphertext[:<span style="color:#d699b6">16</span>]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="intended-by-bruteforcing-the-3-remaining-bytes-of-the-password">Intended (by bruteforcing the 3 remaining bytes of the password)</h3>
<p>We extracted the IV we can get the first 13 bytes of the password :</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>part_password <span style="color:#7a8478">=</span> iv[<span style="color:#d699b6">3</span>:<span style="color:#d699b6">16</span>]
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now we got two solutions:</p>
<ul>
<li>naive : bruteforce the three lasts bytes of the password and try to decrypt each time until we find <code>PWNME</code> in the plaintext. (10 minutes to solve)</li>
<li>less naive : bruteforce the three lasts bytes of the password, hash the candidates and compare it with password_hash in the metadata. (10 sec to solve). Doing that, we only derive the password (which take a lot of ressources), only if we know we got the correct password.</li>
</ul>
<p>Try to guess which one I first implemented.</p>
<p><img src="https://emoji.discadia.com/emojis/833e681b-504e-4746-9bbe-ad5c0bca8240.PNG" alt="clueless"></p>
<p>example of script :</p>
<details>
  <summary style="color: #F99417; cursor: pointer">solve.py</summary>
  <div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">48
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#859289;font-style:italic">#! /usr/bin/env python3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> zlib
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> itertools
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> hashlib
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> re
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">from</span> tqdm <span style="color:#e67e80">import</span> tqdm
</span></span><span style="display:flex;"><span><span style="color:#e67e80">from</span> openzedlib.aes_cbc_zed <span style="color:#e67e80">import</span> AES_CBC_ZED 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>container_file <span style="color:#7a8478">=</span> <span style="color:#d699b6">open</span>(<span style="color:#b2c98f">&#34;flag.txt.ozed&#34;</span>, <span style="color:#b2c98f">&#34;rb&#34;</span>)<span style="color:#7a8478">.</span>read()
</span></span><span style="display:flex;"><span>ciphertext <span style="color:#7a8478">=</span> zlib<span style="color:#7a8478">.</span>decompress(container_file[<span style="color:#d699b6">304</span>:])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#859289;font-style:italic"># Manually read the ozed file and copy the json in the metadata</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>metadata <span style="color:#7a8478">=</span> json<span style="color:#7a8478">.</span>loads(re<span style="color:#7a8478">.</span>search(<span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;{(?:[^</span><span style="color:#b2c98f">{}</span><span style="color:#b2c98f">])*}&#34;</span>, container_file)<span style="color:#7a8478">.</span>group(<span style="color:#d699b6">0</span>))
</span></span><span style="display:flex;"><span>password_hash <span style="color:#7a8478">=</span> metadata[<span style="color:#b2c98f">&#34;password_hash&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#859289;font-style:italic"># we got user = &#34;zed&#34; et part_password = iv[3:16]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">def</span> <span style="color:#b2c98f">bruteforce_password</span>(ciphertext):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	iv <span style="color:#7a8478">=</span> ciphertext[:<span style="color:#d699b6">16</span>]
</span></span><span style="display:flex;"><span>	ct <span style="color:#7a8478">=</span> ciphertext[<span style="color:#d699b6">16</span>:]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	user <span style="color:#7a8478">=</span> iv[:<span style="color:#d699b6">3</span>]
</span></span><span style="display:flex;"><span>	password <span style="color:#7a8478">=</span> iv[<span style="color:#d699b6">3</span>:<span style="color:#d699b6">16</span>]
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	cipher <span style="color:#7a8478">=</span> AES_CBC_ZED(user, password)
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#859289;font-style:italic"># get all bytes possibilities</span>
</span></span><span style="display:flex;"><span>	bytes_possibilities <span style="color:#7a8478">=</span> <span style="color:#d699b6">list</span>(itertools<span style="color:#7a8478">.</span>product(<span style="color:#d699b6">range</span>(<span style="color:#d699b6">256</span>), repeat<span style="color:#7a8478">=</span><span style="color:#d699b6">3</span>))
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">for</span> suffix <span style="color:#7a8478">in</span> tqdm(bytes_possibilities):
</span></span><span style="display:flex;"><span>		candidate_password <span style="color:#7a8478">=</span> password<span style="color:#7a8478">+</span><span style="color:#d699b6">bytes</span>(suffix)
</span></span><span style="display:flex;"><span>		hashed <span style="color:#7a8478">=</span> hashlib<span style="color:#7a8478">.</span>sha256(candidate_password)<span style="color:#7a8478">.</span>hexdigest()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">if</span> hashed <span style="color:#7a8478">==</span> password_hash:
</span></span><span style="display:flex;"><span>			cipher<span style="color:#7a8478">.</span>password <span style="color:#7a8478">=</span> candidate_password
</span></span><span style="display:flex;"><span>			cipher<span style="color:#7a8478">.</span>derive_password()
</span></span><span style="display:flex;"><span>			plaintext <span style="color:#7a8478">=</span> cipher<span style="color:#7a8478">.</span>decrypt(ciphertext)
</span></span><span style="display:flex;"><span>			<span style="color:#d699b6">print</span>(plaintext)
</span></span><span style="display:flex;"><span>			<span style="color:#e67e80">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">if</span> __name__ <span style="color:#7a8478">==</span> <span style="color:#b2c98f">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>	bruteforce_password(ciphertext) <span style="color:#859289;font-style:italic"># about 10 sec to solve </span>
</span></span></code></pre></td></tr></table>
</div>
</div>
</details>

<p>FLAG : <code>PWNME{49e531f28d1cedef03103af6cec79669_th4t_v3Ct0r_k1nd4_l3aky}</code>
7</p>
<h3 id="unintended-using-the-hash">Unintended (using the hash)</h3>
<p>For this one, we just have to decode the password hash from hex which is in the metadata, and take the first 16 bytes, and decrypt everything.</p>
<details>
  <summary style="color: #F99417; cursor: pointer">solve-unintended.py</summary>
  <div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">import</span> zlib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">from</span> hashlib <span style="color:#e67e80">import</span> sha256
</span></span><span style="display:flex;"><span><span style="color:#e67e80">from</span> openzedlib.aes_cbc_zed <span style="color:#e67e80">import</span> AES_CBC_ZED
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>container_file <span style="color:#7a8478">=</span> <span style="color:#d699b6">open</span>(<span style="color:#b2c98f">&#34;flag.txt.ozed&#34;</span>, <span style="color:#b2c98f">&#34;rb&#34;</span>)<span style="color:#7a8478">.</span>read()
</span></span><span style="display:flex;"><span>ciphertext <span style="color:#7a8478">=</span> zlib<span style="color:#7a8478">.</span>decompress(container_file[<span style="color:#d699b6">304</span>:])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>key <span style="color:#7a8478">=</span> <span style="color:#d699b6">bytes</span><span style="color:#7a8478">.</span>fromhex(<span style="color:#b2c98f">&#34;b3a97eb583db5a940c0705e6450b81f4d702a9122d7342a25768e3d75be739be&#34;</span>)[:<span style="color:#d699b6">16</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cipher <span style="color:#7a8478">=</span> AES_CBC_ZED(<span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;&#34;</span>, <span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>cipher<span style="color:#7a8478">.</span>key <span style="color:#7a8478">=</span> key
</span></span><span style="display:flex;"><span>cipher<span style="color:#7a8478">.</span>iv <span style="color:#7a8478">=</span> ciphertext[:<span style="color:#d699b6">16</span>]
</span></span><span style="display:flex;"><span>plaintext <span style="color:#7a8478">=</span> cipher<span style="color:#7a8478">.</span>decrypt(ciphertext)
</span></span><span style="display:flex;"><span><span style="color:#d699b6">print</span>(plaintext)
</span></span></code></pre></td></tr></table>
</div>
</div>
</details>

<p>And it works perfectly : <code>b'PWNME{49e531f28d1cedef03103af6cec79669_th4t_v3Ct0r_k1nd4_l3aky}'</code></p>
<h1 id="my-betterzed">My BetterZED</h1>
<blockquote>
<p>Difficulty : Easy</p>
</blockquote>
<blockquote>
<p><a href="https://github.com/Phreaks-2600/PwnMeCTF-2025-quals/raw/refs/heads/main/Crypto/My_better_Zed/attachments/my_betterzed.zip">Source files</a></p>
</blockquote>
<blockquote>
<p>Description : Patched OpenZed an made it more secure.</p>
</blockquote>
<blockquote>
<p>Author : wepfen (still me)</p>
</blockquote>
<h2 id="tldr-2">TL;DR</h2>
<ul>
<li>
<p>When requesting the flag, the key doesn&rsquo;t change, only the IV does.</p>
</li>
<li>
<p>Notice that the flag has a length of 16 bytes, and so, is encrypted with AES CFB. The IV is encrypted and then xored with the flag.</p>
</li>
<li>
<p>Request a flag a keep the IV, send 16 bytes with the same IV used for the flag and encrypt it. Compares the resulting ciphertext with the encrypted flag.</p>
</li>
<li>
<p>Or, send 16 null bytes with the same IV, resulting in the IV encrypted and xor it with the encrypted flag.</p>
</li>
</ul>
<h2 id="introduction-2">Introduction</h2>
<p>This challenge is as My ZED but with some patches and with a web interface.
On the web interface, we can choose to :</p>
<ul>
<li>
<p>request an encrypted flag</p>
</li>
<li>
<p>encrypt a file and submit optional username, password and IV</p>
</li>
<li>
<p>decrypt a file by giving username and password</p>
</li>
</ul>
<p>I will just focus on the edited parts since I already explained My ZED.</p>
<h2 id="code-analysis-2">Code analysis</h2>
<p>There is the file running the web application :</p>
<details>
  <summary style="color: #F99417; cursor: pointer">app.py</summary>
  <div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">125
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> io
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> string
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">from</span> flask <span style="color:#e67e80">import</span> Flask, render_template, send_file, request
</span></span><span style="display:flex;"><span><span style="color:#e67e80">from</span> openzedlib <span style="color:#e67e80">import</span> openzed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app <span style="color:#7a8478">=</span> Flask(__name__, 
</span></span><span style="display:flex;"><span>			template_folder<span style="color:#7a8478">=</span><span style="color:#b2c98f">&#34;./web/templates&#34;</span>,
</span></span><span style="display:flex;"><span>			static_folder<span style="color:#7a8478">=</span><span style="color:#b2c98f">&#34;./web/static&#34;</span>)
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>FLAG <span style="color:#7a8478">=</span> os<span style="color:#7a8478">.</span>getenv(<span style="color:#b2c98f">&#34;FLAG&#34;</span>, <span style="color:#b2c98f">&#34;PWNME</span><span style="color:#b2c98f">{flag_test}</span><span style="color:#b2c98f">&#34;</span>)
</span></span><span style="display:flex;"><span>KEY <span style="color:#7a8478">=</span> os<span style="color:#7a8478">.</span>urandom(<span style="color:#d699b6">16</span>)
</span></span><span style="display:flex;"><span>USER <span style="color:#7a8478">=</span> <span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;pwnme&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">assert</span> <span style="color:#d699b6">len</span>(FLAG) <span style="color:#7a8478">&lt;=</span> <span style="color:#d699b6">16</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@app.route(<span style="color:#b2c98f">&#39;/&#39;</span>, methods<span style="color:#7a8478">=</span>[<span style="color:#b2c98f">&#39;GET&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#e67e80">def</span> <span style="color:#b2c98f">home</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e67e80">return</span> render_template(<span style="color:#b2c98f">&#39;index.html&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@app.route(<span style="color:#b2c98f">&#39;/encrypt_flag/&#39;</span>, methods<span style="color:#7a8478">=</span>[<span style="color:#b2c98f">&#39;GET&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#e67e80">def</span> <span style="color:#b2c98f">encrypt_flag</span>():
</span></span><span style="display:flex;"><span>	<span style="color:#859289;font-style:italic">#chiffrer avec des creds random</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	file <span style="color:#7a8478">=</span> openzed<span style="color:#7a8478">.</span>Openzed(USER, KEY, <span style="color:#b2c98f">&#39;flag.txt.ozed&#39;</span>)
</span></span><span style="display:flex;"><span>	file<span style="color:#7a8478">.</span>encrypt(FLAG<span style="color:#7a8478">.</span>encode())
</span></span><span style="display:flex;"><span>	file<span style="color:#7a8478">.</span>generate_container()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#859289;font-style:italic">#tricking flask into thinking the data come from a file</span>
</span></span><span style="display:flex;"><span>	encrypted <span style="color:#7a8478">=</span> io<span style="color:#7a8478">.</span>BytesIO(file<span style="color:#7a8478">.</span>secure_container)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">return</span> send_file(
</span></span><span style="display:flex;"><span>        encrypted,
</span></span><span style="display:flex;"><span>        mimetype<span style="color:#7a8478">=</span><span style="color:#b2c98f">&#39;text/plain&#39;</span>,
</span></span><span style="display:flex;"><span>        as_attachment<span style="color:#7a8478">=</span><span style="color:#e67e80">False</span>,
</span></span><span style="display:flex;"><span>        download_name<span style="color:#7a8478">=</span><span style="color:#b2c98f">&#39;flag.txt.ozed&#39;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@app.route(<span style="color:#b2c98f">&#39;/encrypt/&#39;</span>, methods<span style="color:#7a8478">=</span>[<span style="color:#b2c98f">&#39;POST&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#e67e80">def</span> <span style="color:#b2c98f">encrypt_file</span>():
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">if</span> request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;username&#34;</span>] <span style="color:#7a8478">and</span> request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;password&#34;</span>]:
</span></span><span style="display:flex;"><span>		username <span style="color:#7a8478">=</span> request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;username&#34;</span>]<span style="color:#7a8478">.</span>encode()
</span></span><span style="display:flex;"><span>		password <span style="color:#7a8478">=</span> <span style="color:#d699b6">bytes</span><span style="color:#7a8478">.</span>fromhex(request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;password&#34;</span>])
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">else</span>:
</span></span><span style="display:flex;"><span>		username <span style="color:#7a8478">=</span> USER
</span></span><span style="display:flex;"><span>		password <span style="color:#7a8478">=</span> KEY
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">if</span> request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;iv&#34;</span>] :
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">try</span> : 
</span></span><span style="display:flex;"><span>			iv <span style="color:#7a8478">=</span> request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;iv&#34;</span>]
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">except</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#e67e80">return</span> <span style="color:#b2c98f">&#34;Please submit iv hex encoded&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">else</span>:
</span></span><span style="display:flex;"><span>		iv <span style="color:#7a8478">=</span> <span style="color:#e67e80">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">if</span> <span style="color:#7a8478">not</span> request<span style="color:#7a8478">.</span>files <span style="color:#7a8478">or</span> <span style="color:#7a8478">not</span> request<span style="color:#7a8478">.</span>files[<span style="color:#b2c98f">&#34;file&#34;</span>]<span style="color:#7a8478">.</span>filename:
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#b2c98f">&#34;Please upload a file&#34;</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	filename <span style="color:#7a8478">=</span> request<span style="color:#7a8478">.</span>files[<span style="color:#b2c98f">&#34;file&#34;</span>]<span style="color:#7a8478">.</span>filename
</span></span><span style="display:flex;"><span>	file_to_encrypt <span style="color:#7a8478">=</span> request<span style="color:#7a8478">.</span>files[<span style="color:#b2c98f">&#39;file&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	data <span style="color:#7a8478">=</span> file_to_encrypt<span style="color:#7a8478">.</span>stream<span style="color:#7a8478">.</span>read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	file <span style="color:#7a8478">=</span> openzed<span style="color:#7a8478">.</span>Openzed(username, password, filename, iv)
</span></span><span style="display:flex;"><span>	file<span style="color:#7a8478">.</span>encrypt(data)
</span></span><span style="display:flex;"><span>	file<span style="color:#7a8478">.</span>generate_container()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	encrypted <span style="color:#7a8478">=</span> io<span style="color:#7a8478">.</span>BytesIO(file<span style="color:#7a8478">.</span>secure_container)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">return</span> send_file(
</span></span><span style="display:flex;"><span>        encrypted,
</span></span><span style="display:flex;"><span>        mimetype<span style="color:#7a8478">=</span><span style="color:#b2c98f">&#39;text/plain&#39;</span>,
</span></span><span style="display:flex;"><span>        as_attachment<span style="color:#7a8478">=</span><span style="color:#e67e80">False</span>,
</span></span><span style="display:flex;"><span>        download_name<span style="color:#7a8478">=</span>filename<span style="color:#7a8478">+</span><span style="color:#b2c98f">&#34;.ozed&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@app.route(<span style="color:#b2c98f">&#39;/decrypt/&#39;</span>, methods<span style="color:#7a8478">=</span>[<span style="color:#b2c98f">&#39;POST&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#e67e80">def</span> <span style="color:#b2c98f">decrypt_file</span>():
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">if</span> <span style="color:#7a8478">not</span> request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;username&#34;</span>] :
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#b2c98f">&#34;Please submit an username&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">if</span> <span style="color:#7a8478">not</span> request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;password&#34;</span>]:
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#b2c98f">&#34;Please submit a password&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">try</span> : 
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">bytes</span><span style="color:#7a8478">.</span>fromhex(request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;password&#34;</span>])
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">except</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#b2c98f">&#34;Please submit the password hex encoded&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">if</span> <span style="color:#7a8478">not</span> request<span style="color:#7a8478">.</span>files <span style="color:#7a8478">or</span> <span style="color:#7a8478">not</span> request<span style="color:#7a8478">.</span>files[<span style="color:#b2c98f">&#34;file&#34;</span>]<span style="color:#7a8478">.</span>filename:
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#b2c98f">&#34;Please upload a file&#34;</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	username <span style="color:#7a8478">=</span> request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;username&#34;</span>]<span style="color:#7a8478">.</span>encode()
</span></span><span style="display:flex;"><span>	password <span style="color:#7a8478">=</span> <span style="color:#d699b6">bytes</span><span style="color:#7a8478">.</span>fromhex(request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;password&#34;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	filename <span style="color:#7a8478">=</span> request<span style="color:#7a8478">.</span>files[<span style="color:#b2c98f">&#34;file&#34;</span>]<span style="color:#7a8478">.</span>filename
</span></span><span style="display:flex;"><span>	file_to_decrypt <span style="color:#7a8478">=</span> request<span style="color:#7a8478">.</span>files[<span style="color:#b2c98f">&#39;file&#39;</span>]
</span></span><span style="display:flex;"><span>	data <span style="color:#7a8478">=</span> file_to_decrypt<span style="color:#7a8478">.</span>stream<span style="color:#7a8478">.</span>read()
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	file <span style="color:#7a8478">=</span> openzed<span style="color:#7a8478">.</span>Openzed(username, password, filename)
</span></span><span style="display:flex;"><span>	file<span style="color:#7a8478">.</span>secure_container <span style="color:#7a8478">=</span> data
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	decrypted <span style="color:#7a8478">=</span> file<span style="color:#7a8478">.</span>decrypt_container(file<span style="color:#7a8478">.</span>secure_container)
</span></span><span style="display:flex;"><span>	decrypted <span style="color:#7a8478">=</span> io<span style="color:#7a8478">.</span>BytesIO(decrypted[<span style="color:#b2c98f">&#34;data&#34;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">return</span> send_file(
</span></span><span style="display:flex;"><span>        decrypted,
</span></span><span style="display:flex;"><span>        mimetype<span style="color:#7a8478">=</span><span style="color:#b2c98f">&#39;text/plain&#39;</span>,
</span></span><span style="display:flex;"><span>        as_attachment<span style="color:#7a8478">=</span><span style="color:#e67e80">False</span>,
</span></span><span style="display:flex;"><span>        download_name<span style="color:#7a8478">=</span>filename<span style="color:#7a8478">+</span><span style="color:#b2c98f">&#34;.dec&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#859289;font-style:italic"># 10 MB = 2**20 * 10</span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">if</span> __name__ <span style="color:#7a8478">==</span> <span style="color:#b2c98f">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>	app<span style="color:#7a8478">.</span>config[<span style="color:#b2c98f">&#39;MAX_CONTENT_LENGTH&#39;</span>] <span style="color:#7a8478">=</span> <span style="color:#d699b6">1</span> <span style="color:#7a8478">*</span> <span style="color:#d699b6">1024</span> <span style="color:#7a8478">*</span> <span style="color:#d699b6">1024</span>
</span></span><span style="display:flex;"><span>	app<span style="color:#7a8478">.</span>run(debug<span style="color:#7a8478">=</span><span style="color:#e67e80">False</span>, host<span style="color:#7a8478">=</span><span style="color:#b2c98f">&#39;0.0.0.0&#39;</span>, port<span style="color:#7a8478">=</span><span style="color:#d699b6">5000</span>)
</span></span></code></pre></td></tr></table>
</div>
</div>
</details>

<p>I removed the size value from the metadata in <code>openzed.py</code> and added the future to submit an IV at the creation of the instance. If no IV is submitted, then a random one will be chosen.</p>
<details>
  <summary style="color: #F99417; cursor: pointer">openzed.py</summary>
  <div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">generate_iv</span>(<span style="color:#d699b6">self</span>, iv):
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">if</span> iv <span style="color:#7a8478">==</span> <span style="color:#e67e80">None</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>iv <span style="color:#7a8478">=</span> os<span style="color:#7a8478">.</span>urandom(<span style="color:#d699b6">16</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#e67e80">return</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">try</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			iv <span style="color:#7a8478">=</span> <span style="color:#d699b6">bytes</span><span style="color:#7a8478">.</span>fromhex(iv)
</span></span><span style="display:flex;"><span>			<span style="color:#e67e80">if</span> <span style="color:#d699b6">len</span>(iv) <span style="color:#7a8478">!=</span> <span style="color:#d699b6">16</span>:
</span></span><span style="display:flex;"><span>				<span style="color:#e67e80">raise</span> <span style="color:#e67e80">ValueError</span>(<span style="color:#b2c98f">&#34;IV should have a length of 16&#34;</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>iv <span style="color:#7a8478">=</span> iv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">except</span> <span style="color:#e67e80">Exception</span> <span style="color:#e67e80">as</span> e:
</span></span><span style="display:flex;"><span>			<span style="color:#e67e80">raise</span> e
</span></span></code></pre></td></tr></table>
</div>
</div>
</details>

<p>I also removed the size value from the metadata and edited the <code>derive_password</code> function from <code>aes_cbc_zed.py</code> :</p>
<details>
  <summary style="color: #F99417; cursor: pointer">aes_cbc_zed.py</summary>
  <div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">class</span> AES_CBC_ZED:
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">__init__</span>(
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span>, 
</span></span><span style="display:flex;"><span>		user : <span style="color:#d699b6">str</span>, 
</span></span><span style="display:flex;"><span>		password : <span style="color:#d699b6">str</span>, 
</span></span><span style="display:flex;"><span>		iv : <span style="color:#d699b6">bytes</span>
</span></span><span style="display:flex;"><span>	):
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>user <span style="color:#7a8478">=</span> user
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>iv <span style="color:#7a8478">=</span> iv
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password <span style="color:#7a8478">=</span> password
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>derive_password()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[ <span style="color:#7a8478">...</span> ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">derive_password</span>(<span style="color:#d699b6">self</span>):
</span></span><span style="display:flex;"><span>		salt <span style="color:#7a8478">=</span> <span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;LESELFRANCAIS!!!&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>key <span style="color:#7a8478">=</span> PBKDF2(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password, salt, <span style="color:#d699b6">16</span>, count<span style="color:#7a8478">=</span><span style="color:#d699b6">10000</span>, hmac_hash_module<span style="color:#7a8478">=</span>SHA256)
</span></span></code></pre></td></tr></table>
</div>
</div>
</details>

<h3 id="web-interface-endpoints">Web interface endpoints</h3>
<p>Reading app.py :</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>FLAG <span style="color:#7a8478">=</span> os<span style="color:#7a8478">.</span>getenv(<span style="color:#b2c98f">&#34;FLAG&#34;</span>, <span style="color:#b2c98f">&#34;PWNME</span><span style="color:#b2c98f">{flag_test}</span><span style="color:#b2c98f">&#34;</span>)
</span></span><span style="display:flex;"><span>KEY <span style="color:#7a8478">=</span> os<span style="color:#7a8478">.</span>urandom(<span style="color:#d699b6">16</span>)
</span></span><span style="display:flex;"><span>USER <span style="color:#7a8478">=</span> <span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;pwnme&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">assert</span> <span style="color:#d699b6">len</span>(FLAG) <span style="color:#7a8478">&lt;=</span> <span style="color:#d699b6">16</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can understand that the key is defined once, so when requesting the flag multiple times, the same key will be used until we deploy another instance. Also, the user is &ldquo;pwnme&rdquo;.</p>
<p>Requesting <code>/encrypt_flag/</code>, we get the flag encrypted with the key generated at the start :</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>@app.route(<span style="color:#b2c98f">&#39;/encrypt_flag/&#39;</span>, methods<span style="color:#7a8478">=</span>[<span style="color:#b2c98f">&#39;GET&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#e67e80">def</span> <span style="color:#b2c98f">encrypt_flag</span>():
</span></span><span style="display:flex;"><span>	<span style="color:#859289;font-style:italic">#chiffrer avec des creds random</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	file <span style="color:#7a8478">=</span> openzed<span style="color:#7a8478">.</span>Openzed(USER, KEY, <span style="color:#b2c98f">&#39;flag.txt.ozed&#39;</span>)
</span></span><span style="display:flex;"><span>	file<span style="color:#7a8478">.</span>encrypt(FLAG<span style="color:#7a8478">.</span>encode())
</span></span><span style="display:flex;"><span>	file<span style="color:#7a8478">.</span>generate_container()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#e67e80">return</span> send_file(encrypted, mimetype<span style="color:#7a8478">=</span><span style="color:#b2c98f">&#39;text/plain&#39;</span>, as_attachment<span style="color:#7a8478">=</span><span style="color:#e67e80">False</span>, download_name<span style="color:#7a8478">=</span><span style="color:#b2c98f">&#39;flag.txt.ozed&#39;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Looking at <code>/encrypt/</code> :</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>@app.route(<span style="color:#b2c98f">&#39;/encrypt/&#39;</span>, methods<span style="color:#7a8478">=</span>[<span style="color:#b2c98f">&#39;POST&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#e67e80">def</span> <span style="color:#b2c98f">encrypt_file</span>():
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">if</span> request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;username&#34;</span>] <span style="color:#7a8478">and</span> request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;password&#34;</span>]:
</span></span><span style="display:flex;"><span>		username <span style="color:#7a8478">=</span> request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;username&#34;</span>]<span style="color:#7a8478">.</span>encode()
</span></span><span style="display:flex;"><span>		password <span style="color:#7a8478">=</span> <span style="color:#d699b6">bytes</span><span style="color:#7a8478">.</span>fromhex(request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;password&#34;</span>])
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">else</span>:
</span></span><span style="display:flex;"><span>		username <span style="color:#7a8478">=</span> USER
</span></span><span style="display:flex;"><span>		password <span style="color:#7a8478">=</span> KEY
</span></span></code></pre></td></tr></table>
</div>
</div><p>If one submit an user and a password, the file will be encrypted with it.
Else, the user and the key defined at the start of the instance will be used.</p>
<p>And after that, the file will be encrypted and returned to us.</p>
<p>Finally, looking at <code>/decrypt/</code> :</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>@app.route(<span style="color:#b2c98f">&#39;/decrypt/&#39;</span>, methods<span style="color:#7a8478">=</span>[<span style="color:#b2c98f">&#39;POST&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#e67e80">def</span> <span style="color:#b2c98f">decrypt_file</span>():
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">if</span> <span style="color:#7a8478">not</span> request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;username&#34;</span>] :
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#b2c98f">&#34;Please submit an username&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">if</span> <span style="color:#7a8478">not</span> request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;password&#34;</span>]:
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#b2c98f">&#34;Please submit a password&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">try</span> : 
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">bytes</span><span style="color:#7a8478">.</span>fromhex(request<span style="color:#7a8478">.</span>form[<span style="color:#b2c98f">&#34;password&#34;</span>])
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">except</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#b2c98f">&#34;Please submit the password hex encoded&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">if</span> <span style="color:#7a8478">not</span> request<span style="color:#7a8478">.</span>files <span style="color:#7a8478">or</span> <span style="color:#7a8478">not</span> request<span style="color:#7a8478">.</span>files[<span style="color:#b2c98f">&#34;file&#34;</span>]<span style="color:#7a8478">.</span>filename:
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#b2c98f">&#34;Please upload a file&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We must submit an username and a password but not an IV because the IV is supposed to already be inside the ciphertext.</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	filename <span style="color:#7a8478">=</span> request<span style="color:#7a8478">.</span>files[<span style="color:#b2c98f">&#34;file&#34;</span>]<span style="color:#7a8478">.</span>filename
</span></span><span style="display:flex;"><span>	file_to_decrypt <span style="color:#7a8478">=</span> request<span style="color:#7a8478">.</span>files[<span style="color:#b2c98f">&#39;file&#39;</span>]
</span></span><span style="display:flex;"><span>	data <span style="color:#7a8478">=</span> file_to_decrypt<span style="color:#7a8478">.</span>stream<span style="color:#7a8478">.</span>read()
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>	file <span style="color:#7a8478">=</span> openzed<span style="color:#7a8478">.</span>Openzed(username, password, filename)
</span></span><span style="display:flex;"><span>	file<span style="color:#7a8478">.</span>secure_container <span style="color:#7a8478">=</span> data
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	decrypted <span style="color:#7a8478">=</span> file<span style="color:#7a8478">.</span>decrypt_container(file<span style="color:#7a8478">.</span>secure_container)
</span></span><span style="display:flex;"><span>	decrypted <span style="color:#7a8478">=</span> io<span style="color:#7a8478">.</span>BytesIO(decrypted[<span style="color:#b2c98f">&#34;data&#34;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">return</span> send_file(decrypted, mimetype<span style="color:#7a8478">=</span><span style="color:#b2c98f">&#39;text/plain&#39;</span>, as_attachment<span style="color:#7a8478">=</span><span style="color:#e67e80">False</span>, download_name<span style="color:#7a8478">=</span>filename<span style="color:#7a8478">+</span><span style="color:#b2c98f">&#34;.dec&#34;</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then, it is decrypted with the submitted parameter and returned to us.</p>
<h3 id="wheres-the-vulnerability-">Where&rsquo;s the vulnerability ?</h3>
<p>The previous vulnerability from <strong>My Zed</strong> is not relevant because the password is derived differently and the :</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">derive_password</span>(<span style="color:#d699b6">self</span>):
</span></span><span style="display:flex;"><span>		salt <span style="color:#7a8478">=</span> <span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;LESELFRANCAIS!!!&#34;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>key <span style="color:#7a8478">=</span> PBKDF2(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password, salt, <span style="color:#d699b6">16</span>, count<span style="color:#7a8478">=</span><span style="color:#d699b6">10000</span>, hmac_hash_module<span style="color:#7a8478">=</span>SHA256
</span></span></code></pre></td></tr></table>
</div>
</div><p>So let&rsquo;s look deeper at the process of encrypting and decrypting.</p>
<p>To get <strong>decrypted/encrypted</strong>, a call to encrypt() or decrypt() have to be made to an openzed object :</p>
<div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">encrypt</span>(<span style="color:#d699b6">self</span>, data):
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>		cipher <span style="color:#7a8478">=</span> AES_CBC_ZED(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>user, <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password, <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>iv)
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>encrypted <span style="color:#7a8478">=</span> cipher<span style="color:#7a8478">.</span>encrypt(data)
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>encrypted <span style="color:#7a8478">=</span> zlib<span style="color:#7a8478">.</span>compress(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>encrypted) <span style="color:#859289;font-style:italic"># just for the lore	</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>encrypted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e67e80">def</span> <span style="color:#b2c98f">decrypt</span>(<span style="color:#d699b6">self</span>, ciphertext):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		cipher <span style="color:#7a8478">=</span> AES_CBC_ZED(<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>user, <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>password, <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>iv)
</span></span><span style="display:flex;"><span>		ciphertext <span style="color:#7a8478">=</span> zlib<span style="color:#7a8478">.</span>decompress(ciphertext)
</span></span><span style="display:flex;"><span>		<span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>decrypted <span style="color:#7a8478">=</span> cipher<span style="color:#7a8478">.</span>decrypt(ciphertext)
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>decrypted
</span></span></code></pre></td></tr></table>
</div>
</div><p>Which call an underlying function <strong>decrypt/encrypt</strong> from AES_CBC_ZED object. Let&rsquo;s look at the encrypt function :</p>
<details>
  <summary style="color: #F99417; cursor: pointer">aes_cbc_zed.encrypt</summary>
  <div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">def</span> <span style="color:#b2c98f">encrypt</span>(<span style="color:#d699b6">self</span>, plaintext: <span style="color:#d699b6">bytes</span>):
</span></span><span style="display:flex;"><span>		iv <span style="color:#7a8478">=</span> <span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>iv
</span></span><span style="display:flex;"><span>		ciphertext <span style="color:#7a8478">=</span> <span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>		ecb_cipher <span style="color:#7a8478">=</span> AES<span style="color:#7a8478">.</span>new(key<span style="color:#7a8478">=</span><span style="color:#d699b6">self</span><span style="color:#7a8478">.</span>key, mode<span style="color:#7a8478">=</span>AES<span style="color:#7a8478">.</span>MODE_ECB)
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">for</span> pos <span style="color:#7a8478">in</span> <span style="color:#d699b6">range</span>(<span style="color:#d699b6">0</span>, <span style="color:#d699b6">len</span>(plaintext), <span style="color:#d699b6">16</span>):
</span></span><span style="display:flex;"><span>			chunk <span style="color:#7a8478">=</span> plaintext[pos:pos<span style="color:#7a8478">+</span><span style="color:#d699b6">16</span>]
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>			<span style="color:#859289;font-style:italic"># AES CFB for the last block or if there is only one block</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e67e80">if</span> <span style="color:#d699b6">len</span>(plaintext[pos<span style="color:#7a8478">+</span><span style="color:#d699b6">16</span>:pos<span style="color:#7a8478">+</span><span style="color:#d699b6">32</span>]) <span style="color:#7a8478">==</span> <span style="color:#d699b6">0</span> :
</span></span><span style="display:flex;"><span>				<span style="color:#859289;font-style:italic">#if plaintext length &lt;= 16, iv = self.iv</span>
</span></span><span style="display:flex;"><span>				<span style="color:#e67e80">if</span> <span style="color:#d699b6">len</span>(plaintext) <span style="color:#7a8478">&lt;=</span> <span style="color:#d699b6">16</span> :
</span></span><span style="display:flex;"><span>					prev<span style="color:#7a8478">=</span>iv
</span></span><span style="display:flex;"><span>				<span style="color:#859289;font-style:italic"># else, iv = previous ciphertext</span>
</span></span><span style="display:flex;"><span>				<span style="color:#e67e80">else</span>:
</span></span><span style="display:flex;"><span>					prev<span style="color:#7a8478">=</span>ciphertext[pos<span style="color:#7a8478">-</span><span style="color:#d699b6">16</span>:pos]
</span></span><span style="display:flex;"><span>					
</span></span><span style="display:flex;"><span>				prev <span style="color:#7a8478">=</span> ecb_cipher<span style="color:#7a8478">.</span>encrypt(prev)
</span></span><span style="display:flex;"><span>				ciphertext <span style="color:#7a8478">+=</span> xor(chunk, prev)
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>			<span style="color:#859289;font-style:italic"># AES CBC for the n-1 firsts block</span>
</span></span><span style="display:flex;"><span>			<span style="color:#e67e80">elif</span> <span style="color:#7a8478">not</span> ciphertext:
</span></span><span style="display:flex;"><span>				xored <span style="color:#7a8478">=</span> <span style="color:#d699b6">bytes</span>(xor(plaintext, iv))
</span></span><span style="display:flex;"><span>				ciphertext <span style="color:#7a8478">+=</span> ecb_cipher<span style="color:#7a8478">.</span>encrypt(xored)
</span></span><span style="display:flex;"><span>				
</span></span><span style="display:flex;"><span>			<span style="color:#e67e80">else</span>:
</span></span><span style="display:flex;"><span>				xored <span style="color:#7a8478">=</span> <span style="color:#d699b6">bytes</span>(xor(chunk, ciphertext[pos<span style="color:#7a8478">-</span><span style="color:#d699b6">16</span>:pos]))
</span></span><span style="display:flex;"><span>				ciphertext <span style="color:#7a8478">+=</span> ecb_cipher<span style="color:#7a8478">.</span>encrypt(xored)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#e67e80">return</span> ciphertext
</span></span></code></pre></td></tr></table>
</div>
</div>
</details>

<p>In shorts, if the plaintext as a length of more than 16 :</p>
<p><img src="../../images/writeups/pwnme/aes_cbc_zed_encrypt.jpg" alt="aes cbc zed encrypt"></p>
<p>The first blocks are encrypted with AES CBC and the last with AES CFB.</p>
<p>But when the plaintext has a length below or equal to 16 :</p>
<p><img src="../../images/writeups/pwnme/aes_cbc_zed_encrypt_2.jpg" alt="aes cbc zed encrypt"></p>
<p>The plaintext is encrypted with AES CFB.</p>
<p>With <code>decrypt()</code>, the process is reproduced but in reverse.</p>
<p>Fast forward, remember the flag has a length of 16 in app.py:18 : <code>assert len(FLAG) &lt;= 16</code>.</p>
<p>So it is encrypted with the CFB part which is :</p>
<ul>
<li>encrypt the IV with the KEY (the key never change)</li>
<li>xor it with the plaintext</li>
</ul>
<p>There are two ways to recover the flag :</p>
<ol>
<li></li>
</ol>
<ul>
<li>Send a file of length 16 with only null bytes</li>
<li>The result will be the encrypted IV xored with null bytes, so still the IV</li>
<li>Then now we got the encrypted IV, we can XOR it with the encrypted flag and get the flag</li>
</ul>
<ol start="2">
<li></li>
</ol>
<ul>
<li>Send 256 files with 16 bytes of value <code>int.from_bytes(i)</code> with i from 0 to 255</li>
<li>Send the data one after another with the same IV as the flag</li>
<li>See if in the result there are the same byte at the same position on the encrypted file and the encrypted flag</li>
<li>recover the flag</li>
</ul>
<p><img src="../../images/writeups/pwnme/betterzed_2nd_solution.jpg" alt="betterzed second solution"></p>
<h2 id="solving-2">Solving</h2>
<p>Here&rsquo;s a script for the second solution  (2 seconds to solve) :</p>
<details>
  <summary style="color: #F99417; cursor: pointer">solve.py</summary>
  <div class="highlight"><div style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#6b655a">59
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#d6cbb4;background-color:#252b2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e67e80">from</span> openzedlib <span style="color:#e67e80">import</span> openzed
</span></span><span style="display:flex;"><span><span style="color:#e67e80">from</span> tqdm <span style="color:#e67e80">import</span> tqdm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> re
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> io
</span></span><span style="display:flex;"><span><span style="color:#e67e80">import</span> zlib
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>URL <span style="color:#7a8478">=</span> <span style="color:#b2c98f">&#34;http://127.0.0.1:5000/&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#859289;font-style:italic"># request the encrypt file and get the filename</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flag_enc <span style="color:#7a8478">=</span> requests<span style="color:#7a8478">.</span>get(URL<span style="color:#7a8478">+</span><span style="color:#b2c98f">&#34;encrypt_flag/&#34;</span>)
</span></span><span style="display:flex;"><span>d <span style="color:#7a8478">=</span> flag_enc<span style="color:#7a8478">.</span>headers[<span style="color:#b2c98f">&#39;content-disposition&#39;</span>]
</span></span><span style="display:flex;"><span>filename <span style="color:#7a8478">=</span> re<span style="color:#7a8478">.</span>findall(<span style="color:#b2c98f">&#34;filename=(.+)&#34;</span>, d)[<span style="color:#d699b6">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#859289;font-style:italic"># create a openzed object with an user with same length as in the ciphertext, any password, </span>
</span></span><span style="display:flex;"><span><span style="color:#859289;font-style:italic"># any iv as in the ciphertext and the filename we recovered before</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flag_enc_openzed <span style="color:#7a8478">=</span> openzed<span style="color:#7a8478">.</span>Openzed(<span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;pwnme&#34;</span>, <span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;idk&#34;</span>, filename)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#859289;font-style:italic"># load the flag ciphertext and read it&#39;s metadata to get the correct values and recover the IV</span>
</span></span><span style="display:flex;"><span><span style="color:#859289;font-style:italic"># We can also recover the IV manually by reading flag_enc</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flag_enc_openzed<span style="color:#7a8478">.</span>secure_container <span style="color:#7a8478">=</span> flag_enc<span style="color:#7a8478">.</span>content
</span></span><span style="display:flex;"><span>flag_enc_openzed<span style="color:#7a8478">.</span>read_metadata()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>iv <span style="color:#7a8478">=</span> flag_enc_openzed<span style="color:#7a8478">.</span>parsed_metadata[<span style="color:#b2c98f">&#34;iv&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#859289;font-style:italic"># Now we can start to craft a payload</span>
</span></span><span style="display:flex;"><span><span style="color:#859289;font-style:italic"># We will encrypt it through /encrypt_file endpoint</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flag_ciphertext <span style="color:#7a8478">=</span> flag_enc_openzed<span style="color:#7a8478">.</span>secure_container[<span style="color:#d699b6">304</span>:]
</span></span><span style="display:flex;"><span>flag <span style="color:#7a8478">=</span> [<span style="color:#d699b6">0</span>] <span style="color:#7a8478">*</span> <span style="color:#d699b6">16</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#859289;font-style:italic"># trick requests into thinking file.content come from a file by using io.BytesIO</span>
</span></span><span style="display:flex;"><span><span style="color:#859289;font-style:italic"># empty password and username so the oracle KEY and USER get used</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e67e80">for</span> i <span style="color:#7a8478">in</span> tqdm(<span style="color:#d699b6">range</span>(<span style="color:#d699b6">255</span>)):
</span></span><span style="display:flex;"><span>    payload <span style="color:#7a8478">=</span> [i] <span style="color:#7a8478">*</span> <span style="color:#d699b6">16</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    r <span style="color:#7a8478">=</span> requests<span style="color:#7a8478">.</span>post(URL<span style="color:#7a8478">+</span><span style="color:#b2c98f">&#34;/encrypt/&#34;</span>, files<span style="color:#7a8478">=</span>{<span style="color:#b2c98f">&#39;file&#39;</span>: (<span style="color:#b2c98f">&#39;file.txt&#39;</span>, io<span style="color:#7a8478">.</span>BytesIO(<span style="color:#d699b6">bytearray</span>(payload)))}, data <span style="color:#7a8478">=</span> {<span style="color:#b2c98f">&#34;iv&#34;</span> : iv, <span style="color:#b2c98f">&#34;username&#34;</span>:<span style="color:#b2c98f">&#34;&#34;</span>, <span style="color:#b2c98f">&#34;password&#34;</span>:<span style="color:#b2c98f">&#34;&#34;</span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    tmp_ozed <span style="color:#7a8478">=</span> openzed<span style="color:#7a8478">.</span>Openzed(<span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;pwnme&#34;</span>, <span style="color:#b2c98f">b</span><span style="color:#b2c98f">&#34;idk&#34;</span>, filename, iv)
</span></span><span style="display:flex;"><span>    tmp_ozed<span style="color:#7a8478">.</span>secure_container <span style="color:#7a8478">=</span> r<span style="color:#7a8478">.</span>content
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#859289;font-style:italic"># the ciphertext is compressed, openzed.py.openzed.encrypt</span>
</span></span><span style="display:flex;"><span>    my_ct <span style="color:#7a8478">=</span> zlib<span style="color:#7a8478">.</span>decompress(tmp_ozed<span style="color:#7a8478">.</span>secure_container[<span style="color:#d699b6">304</span>:])
</span></span><span style="display:flex;"><span>    flag_ct <span style="color:#7a8478">=</span> zlib<span style="color:#7a8478">.</span>decompress(flag_ciphertext)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#e67e80">for</span> counter, tupl <span style="color:#7a8478">in</span> <span style="color:#d699b6">enumerate</span>(<span style="color:#d699b6">zip</span>(my_ct, flag_ct)):
</span></span><span style="display:flex;"><span>        <span style="color:#e67e80">if</span> tupl[<span style="color:#d699b6">0</span>] <span style="color:#7a8478">==</span> tupl[<span style="color:#d699b6">1</span>]:
</span></span><span style="display:flex;"><span>            flag[counter] <span style="color:#7a8478">=</span> i
</span></span><span style="display:flex;"><span>            <span style="color:#d699b6">print</span>(<span style="color:#d699b6">bytes</span>(flag))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#d699b6">print</span>(<span style="color:#d699b6">bytes</span>(flag))
</span></span></code></pre></td></tr></table>
</div>
</div>
</details>

<p>Flag : <code>PWNME{zEd_15_3z}</code></p>
<h1 id="conclusion">Conclusion</h1>
<p>With these challenges and the <a href="https://wepfen.github.io/writeups/mafia-at-the-end-of-the-block-full/">blockchains ones</a>, it was my first time creating challenges.</p>
<p>I learnt a lot during the design stage but made some mistakes resulting in unintended solves.</p>
<p>I will do more challenges for sure but next time, I will try to make more shorter challenge like easy diffy or test more carefully my challenges.</p>
<p><img src="../../images/memes/thumbup.png" alt="thumb up emoji"></p>
<h1 id="other-writeups">Other writeups</h1>
<ul>
<li><a href="https://mqcybersec.org/writeups/25-pwnmequals-easydiffy">mqcybersec.org - easydiffy</a></li>
<li><a href="https://yocchin.hatenablog.com/entry/2025/03/06/080901#Easy-Diffy-Crypto">yocchin.hatenablog.com - Easy Diffy</a></li>
<li><a href="https://yocchin.hatenablog.com/entry/2025/03/06/080901#My-Zed-Crypto">yocchin.hatenablog.com - My Zed</a></li>
</ul>
</article>

            </div>
        </main>

  
    </body>
</html>
